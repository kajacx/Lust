use std::str::FromStr;
use crate::*;

grammar;

pub LuaStatements: Vec<LuaStatement> = {
    <s:LuaStatement> => vec![s],
    <mut r:LuaStatements> <s:LuaStatement> => {
        r.push(s);
        r
    },
}

LuaStatement: LuaStatement = {
    "--" <c:SingleLineComment> => LuaStatement::Comment(c),
    "local" <n:VarName> "=" <v:Expression> => LuaStatement::VarDeclaration {
        name: n,
        value: v,
    },
};

VarName: String = <s:r"[a-zA-Z_]\w+"> => s.to_string();

SingleLineComment: LuaComment = {
    "@type" <t:Type> => LuaComment::TypeAnnotation(t),
}

Type: LustType = {
    "number" => LustType::Number,
    "string" => LustType::String,
}

Expression: LuaExpression = {
    r#""[^"]*""# => {
        // Remove the surrounding quotes
        let s = &<>[1..<>.len()-1];
        LuaExpression::StringLiteral(s.to_string())
    },
    r"[0-9]+" => LuaExpression::NumberLiteral(f64::from_str(<>).unwrap()),
}
